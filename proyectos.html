<!--
CRM 2N – Modo Desarrollador Eficiente
Estilo Salesforce Moderno + Apple Clean UI
Firebase optimizado (mínimas lecturas, funciones reutilizables, sin llamadas duplicadas)
-->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM – Proyectos</title>

    <!-- Estilos globales -->
    <link rel="stylesheet" href="styles.css">

    <style>
        /* ===== ESTILO SALESFORCE MODERNO – PROYECTOS ===== */

        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            background: #F5F7FA;
            color: #1A1A1A;
        }

        .topbar {
            height: 60px;
            background: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            font-weight: 600;
            font-size: 18px;
        }

        .content {
            padding: 25px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .project-card {
            background: white;
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            transition: 0.2s;
            cursor: pointer;
        }

        .project-card:hover {
            transform: scale(1.01);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .project-name {
            font-size: 18px;
            font-weight: 600;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .badge.pipeline {
            background: #4C6EF5;
        }

        .badge.ganado {
            background: #2F9E44;
        }

        .badge.perdido {
            background: #E03131;
        }

        .badge.prescripcion {
            background: #FD7E14;
        }

        .project-info {
            font-size: 14px;
        }

        .btn-add {
            background: #4C6EF5;
            color: white;
            padding: 12px 18px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: 0.2s;
        }

        .btn-add:hover {
            background: #3B5BDB;
        }
    </style>
</head>

<body>

    <div class="topbar">
        CRM 2N – Proyectos
    </div>

    <div class="content">

        <button class="btn-add" onclick="nuevoProyecto()">
            + Nuevo Proyecto
        </button>

        <div class="section-title">Todos los proyectos</div>

        <div id="listaProyectos"></div>

    </div>

    <script type="module">
        import { db } from "./firebaseConfig.js";
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const lista = document.getElementById("listaProyectos");

        // ==== Cargar proyectos (mínima lectura Firebase) ====
        async function cargarProyectos() {
            const ref = collection(db, "proyectos");
            const snap = await getDocs(ref);

            lista.innerHTML = "";

            snap.forEach(doc => {
                const p = doc.data();

                const estadoClass =
                    p.estado === "Pipeline" ? "pipeline" :
                    p.estado === "Ganado" ? "ganado" :
                    p.estado === "Perdido" ? "perdido" :
                    "prescripcion";

                const card = `
                    <div class="project-card" onclick="verProyecto('${doc.id}')">
                        <div class="project-header">
                            <div class="project-name">${p.nombre || "Sin nombre"}</div>
                            <div class="badge ${estadoClass}">${p.estado}</div>
                        </div>

                        <div class="project-info">
                            <b>Cliente:</b> ${p.cliente || "-"}<br>
                            <b>Ciudad:</b> ${p.ciudad || "-"}<br>
                            <b>Fecha:</b> ${p.fecha || "-"}
                        </div>
                    </div>
                `;

                lista.innerHTML += card;
            });
        }

        cargarProyectos();

        // ==== Acciones ====
        window.verProyecto = (id) => {
            window.location.href = `proyecto_detalle.html?id=${id}`;
        }

        window.nuevoProyecto = () => {
            window.location.href = "proyecto_nuevo.html";
        }
    </script>

</body>
</html>
