<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM 2N – Buscar</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- NAV SUPERIOR -->
    <div class="topnav">
        <div class="logo">CRM 2N</div>

        <div class="nav-tabs">
            <div class="nav-item" onclick="location.href='index.html'">Dashboard</div>
            <div class="nav-item" onclick="location.href='proyectos.html'">Proyectos</div>
            <div class="nav-item active" onclick="location.href='buscar.html'">Buscar</div>
            <div class="nav-item" onclick="location.href='pipeline.html'">Pipeline</div>
            <div class="nav-item" onclick="location.href='clientes.html'">Clientes</div>
            <div class="nav-item" onclick="location.href='tareas.html'">Tareas</div>
            <div class="nav-item" onclick="location.href='reportes.html'">Reportes</div>
        </div>

        <input type="text" class="search-box" placeholder="Buscar..." />
    </div>

    <main class="content" style="max-width:900px;margin:auto;">
        <h2 style="margin:0;color:#16325C;">Scouting de obras (IA)</h2>
        <div style="font-size:12px;color:#5A6872;margin-bottom:16px;">
            Genera un prompt perfecto para scouting y obtén un CSV listo para importar.
        </div>

        <!-- PANEL SCOUTING (diseño compacto original) -->
        <div class="panel" style="margin-bottom:20px;">
            <div class="panel-title">Generar prompt de scouting</div>

            <div class="form-group">
                <label for="zonas">Zonas objetivo</label>
                <input id="zonas" value="Madrid, Málaga, Valencia, Alicante, Barcelona, Mallorca" />
            </div>

            <div class="form-group">
                <label for="segmento">Segmento</label>
                <input id="segmento" value="Residencial obra nueva, villas, lujo, oficinas" />
            </div>

            <div class="form-group">
                <label for="horizonte">Horizonte</label>
                <input id="horizonte" value="En diseño, licitación o construcción (3-5 años)" />
            </div>

            <div class="form-group">
                <label for="extra">Criterios extra</label>
                <input id="extra" placeholder="BTR, >80 viviendas, operador institucional..." />
            </div>

            <div class="form-group">
                <label>Prompt generado</label>
                <textarea id="prompt" rows="10" class="textarea-input"></textarea>
            </div>

            <button class="btn-primary" onclick="generarPrompt()">Generar prompt</button>
            <button class="btn-secondary" onclick="copiarPrompt()">Copiar</button>
        </div>

        <!-- PANEL RESULTADO CSV (diseño original compacto) -->
        <div class="panel">
            <div class="panel-title">Pegar CSV y descargar</div>

            <div class="form-group">
                <label>Resultado IA (CSV)</label>
                <textarea id="csvInput" rows="8" class="textarea-input"></textarea>
            </div>

            <button class="btn-primary" onclick="descargarCSV()">Descargar CSV</button>
        </div>
    </main>

    <script>
        function generarPrompt() {
            const zonas = document.getElementById("zonas").value;
            const segmento = document.getElementById("segmento").value;
            const horizonte = document.getElementById("horizonte").value;
            const extra = document.getElementById("extra").value;

            document.getElementById("prompt").value = `
Actúa como un analista experto en mercado inmobiliario + asistente de scouting para la empresa 2N (videoporteros IP y control de accesos).

Objetivo:
- Detectar obras relevantes para soluciones de acceso IP.
- Priorizar proyectos donde existan: portales, garajes, zonas comunes, oficinas, accesos múltiples o edificios premium.

Criterios:
- Zonas: ${zonas}
- Segmento: ${segmento}
- Horizonte: ${horizonte}
${extra ? "- Extra: " + extra : ""}

Formato de salida:
Devuelve SOLO una tabla CSV separada por punto y coma con estas columnas EXACTAS:

nombre_obra;
cliente_principal;
ciudad;
provincia;
tipo;
segmento;
num_unidades;
estado;
promotora;
constructora;
arquitectura;
ingenieria;
potencial_eur;
telefono_cliente;
email_cliente;
url_obra;
encaje_2n;
motivo_encaje_2n

Instrucciones sobre URL:
- url_obra debe ser SIEMPRE una página web real.
- Prioriza página oficial de la promoción.  
- Si no existe → página del promotor, constructora o noticia oficial.
- Debe empezar por http o https.

Definición rápida encaje 2N:
- ALTO → Residencial + zonas comunes + garaje + varios accesos.
- MEDIO → Residencial sin garaje o oficinas medianas.
- BAJO → Obra pequeña sin accesos relevantes.

Devuelve SOLO la tabla CSV.            
`.trim();
        }

        function copiarPrompt() {
            const txt = document.getElementById("prompt");
            txt.select();
            document.execCommand("copy");
            alert("Prompt copiado");
        }

        function descargarCSV() {
            const contenido = document.getElementById("csvInput").value.trim();
            if (!contenido) {
                alert("Pega primero el CSV generado por la IA.");
                return;
            }

            const blob = new Blob([contenido], { type: "text/csv;charset=utf-8;" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            const fecha = new Date().toISOString().slice(0, 10);

            a.href = url;
            a.download = `scouting_2n_${fecha}.csv`;
            document.body.appendChild(a);
            a.click();
            a.remove();
        }

        window.onload = generarPrompt;
    </script>

</body>
</html>
